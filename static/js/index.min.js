function randomColor(){for(var e=colorArray.length-1;e>=0;e--){var t=Math.floor(Math.random()*colorArray.length);return colorArray[t]}}function setID(e){sendTo=e}function connectUser(e,t){color=randomColor(),socket.emit("login",e,t,color)}function sendMessage(){var e=document.getElementById("message").value;if(1==imgSelected)if(""==sendTo){var t=$("#myImg").attr("src");socket.emit("sendImgMsg",localStorage.getItem("email"),localStorage.getItem("name"),t,color),$("#tempDiv").remove(),imgSelected=0}else{t=$("#myImg").attr("src");socket.emit("sendImgMsgInd",{toId:sendTo,from:localStorage.getItem("name"),fromEmail:localStorage.getItem("email"),img:t,clr:color}),$("#tempDiv").remove();var n=(new Date).getUTCMilliseconds(),o='<li style="color:'+color+'; text-align: right;"><img id="'+n+'" width="300px" height="200px" align="middle">  : Me</li>';$("#oList").append(o);document.getElementById(n).src=decodeURIComponent(imageData)}else if(""==sendTo)socket.emit("sendMessage",localStorage.getItem("email"),localStorage.getItem("name"),e,color);else{socket.emit("sendToIndividual",{toId:sendTo,from:localStorage.getItem("name"),fromEmail:localStorage.getItem("email"),msg:e,clr:color});o='<li style="color:'+color+'; text-align: right;">'+e+" : Me</li>";$("#oList").append(o)}document.getElementById("message").value=""}function createOList(e){for(var t=JSON.parse(e),n="",o=0;o<t.data.length;o++){t.data[o].id;n+="<li>"+t.data[o].name+"</li>"}document.getElementById("OnlineList").innerHTML=n}function getUserList(){var e=new XMLHttpRequest;e&&(e.onreadystatechange=function(){4!=e.readyState?console.log("its in process"):200==e.status?createList(e.response):alert("Its in Error")},e.open("GET","api/user/"),e.send(null))}function saveRecord(){var e=new Object;e.name=document.getElementById("add_name").value,e.pass=document.getElementById("add_pass").value,e.phone=document.getElementById("add_phone").value,e.email=document.getElementById("add_email").value,document.getElementById("add_name").value="",document.getElementById("add_pass").value="",document.getElementById("add_phone").value="",document.getElementById("add_email").value="";var t=new XMLHttpRequest;t&&(t.onreadystatechange=function(){4!=t.readyState?console.log("its in process"):200==t.status?(alert(this.responseText),onload()):console.log("Error")},t.open("POST","/api/user/"),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e)))}function createList(e){for(var t=JSON.parse(e),n="",o=0;o<t.data.length;o++){var a=t.data[o].id;t.data[o].admin?n+='<tr><td id="tt">'+t.data[o].name+'</td><td id="tt">'+t.data[o].phone+'</td><td id="tt">'+t.data[o].email+'</td><td id="tt">Admin</td><td id="tt"><button onclick="updateRecord(\''+a+'\')" class="btn btn-info test">Edit</button> <button onclick="requestForDelete(\''+a+'\')" class="btn btn-warning">Delete</button></td></tr>':n+='<tr><td id="tt">'+t.data[o].name+'</td><td id="tt">'+t.data[o].phone+'</td><td id="tt">'+t.data[o].email+'</td><td id="tt">Non Admin</td><td id="tt"><button onclick="updateRecord(\''+a+'\')" class="btn btn-info test">Edit</button> <button onclick="requestForDelete(\''+a+'\')" class="btn btn-warning">Delete</button></td></tr>'}document.getElementById("empTable").innerHTML=n}function requestForDelete(e){1==confirm("Are you sure, you want to delete this record")&&deleteRecord(e)}function deleteRecord(e){var t=new XMLHttpRequest;t&&(t.onreadystatechange=function(){4!=t.readyState?console.log("its in process"):200==t.status?(alert(this.responseText),onload()):console.log("Error")},t.open("DELETE","/api/user/"+e),t.send(null))}function updateRecord(e){var t=new XMLHttpRequest;t&&(t.onreadystatechange=function(){4!=t.readyState?console.log("its in process"):200==t.status?createForm(t.response,e):console.log("Error")},t.open("GET","/api/user/"+e),t.send(null))}function login(){var e=new Object;e.pass=document.getElementById("login_pass").value,e.email=document.getElementById("login_email").value,document.getElementById("login_pass").value="",document.getElementById("login_email").value="";var t=new XMLHttpRequest;t&&(t.onreadystatechange=function(){4!=t.readyState?console.log("its in process"):200==t.status?afterLogin(t.response):console.log("Error")},t.open("POST","/api/user/login"),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e)))}function afterLogin(e){var t=JSON.parse(e);t.success?t.data.admin?(email=t.data.email,localStorage.setItem("email",email),localStorage.setItem("name",t.data.name),localStorage.setItem("admin","Admin"),alert(t.message),showAdmin(),connectUser(t.data.name,email)):(email=t.data.email,localStorage.setItem("email",email),localStorage.setItem("name",t.data.name),localStorage.setItem("admin","Non Admin"),alert(t.message),showNonAdmin(),connectUser(t.data.name,email)):alert(t.message)}function inviteUser(){var e=new Object;e.type=document.getElementById("invite_type").value,e.email=document.getElementById("invite_email").value,e.aemail=localStorage.getItem("email");var t=e.email,n=new XMLHttpRequest;n&&(n.onreadystatechange=function(){4!=n.readyState?console.log("its in process"):200==n.status?afterInvite(n.response,t):console.log("Error")},n.open("POST","/api/invite/"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e)))}function afterInvite(e,t){var n=JSON.parse(e);if(n.flag){1==confirm(n.message)&&inviteAgain(t)}else alert(n.message)}function inviteAgain(e){var t=new Object;t.email=e;var n=new XMLHttpRequest;n&&(n.onreadystatechange=function(){4!=n.readyState?console.log("its in process"):200==n.status?alert(this.responseText):console.log("Error")},n.open("POST","/api/invite/resend"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t)))}function createForm(e,t){var n=JSON.parse(e),o="";$("#addEmp").hide(),document.getElementById("name").value=n.name,document.getElementById("city").value=n.city,document.getElementById("phone").value=n.phone,document.getElementById("email").value=n.email,o+="<br> <button onclick=\"updateRec('"+t+'\');" class="btn btn-info">Update</button> <button onclick="CloseInput();" class="btn btn-default">Cancel</button>',document.getElementById("btn").innerHTML=o}function updateRec(e){var t=new Object;t.name=document.getElementById("name").value,t.city=document.getElementById("city").value,t.phone=document.getElementById("phone").value,t.email=document.getElementById("email").value;var n=new XMLHttpRequest;n&&(n.onreadystatechange=function(){4!=n.readyState?console.log("its in process"):200==n.status?(alert(this.responseText),onload()):console.log("Error")},n.open("PUT","/api/user/"+e),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t)))}function CloseInput(){$("#formLogin").show(),$("#afterLogin").hide()}function showLogin(){$("#formLogin").show(),$("#afterLogin").hide()}function showAdmin(){$("#formLogin").hide(),$("#afterLogin").show(),$("#users").hide(),$("#userList").hide(),$("#invite").show()}function showUser(){$("#invite").hide(),$("#users").show(),$("#chatContainer").hide(),getUserList()}function showChat(){$("#invite").hide(),$("#users").hide(),$("#chatContainer").show(),$("#chat_window").show(),$("#userList").show()}function showInvite(){$("#invite").show(),$("#users").hide(),$("#chatContainer").hide()}function showNonAdmin(){$("#formLogin").hide(),$("#afterLogin").show(),$("#chatContainer").show(),$("#chat_window").show(),$("#invite").hide(),$("#users").hide(),$(".dd").hide()}function logout(){localStorage.clear(),onload()}function imageIsLoaded(e){imageData=e.target.result;$("#oList").append('<center><div id="tempDiv" class="container" style="width:300px; height:200px;"><img id="myImg" width="300px" height="200px" align="middle"><div class="centered">Click Send to send</div> <span class="cancel" onclick="removeDiv()">X</span></div></center>');document.getElementById("myImg").src=e.target.result,imgSelected=1}function removeDiv(){$("#tempDiv").remove(),imgSelected=0}console.log=function(){},localStorage.setItem(email,"");var email="",socket=io.connect(""),color="",sendTo="",imgSelected=0,colorArray=["#FF6633","#FFB399","#FF33FF","#00B3E6","#3366E6","#999966","#99FF99","#B34D4D","#80B300","#809900","#E6B3B3","#6680B3","#66991A","#FF99E6","#CCFF1A","#FF1A66","#E6331A","#33FFCC","#66994D","#B366CC","#4D8000","#B33300","#CC80CC","#66664D","#991AFF","#E666FF","#4DB3FF","#1AB399","#E666B3","#33991A","#CC9999","#B3B31A","#00E680","#4D8066","#809980","#E6FF80","#1AFF33","#999933","#FF3380","#66E64D","#4D80CC","#9900B3","#E64D66","#4DB380","#FF4D4D","#99E6E6","#6666FF"];socket.on("userList",function(e){for(var t="",n=0;n<e.length;n++){var o=e[n].id;t+="<a  href=\"javascript:setID('"+o+'\')" ><li id="'+o+'" class="userlistLi" style="color:'+e[n].color+'">â–º '+e[n].name+"</li></a>"}document.getElementById("userListOnline").innerHTML=t}),socket.on("sendMsg",function(e){if(e.fromEmail==localStorage.getItem("email"))var t='<li style="color:'+e.clr+'; text-align: right;">'+e.msg+" : Me</li>";else t='<li style="color:'+e.clr+'; text-align: left;">'+e.from+" : "+e.msg+"</li>";$("#oList").append(t)}),socket.on("out",function(e){for(var t="",n=0;n<e.length;n++){t="<a  href=\"javascript:setID('"+e[0].id+'\')" ><li style="color:'+e[n].color+'">'+e[n].name+"</li></a>"}document.getElementById("userListOnline").innerHTML=t}),socket.on("displayMsg",function(e,t,n,o,a){if(e==localStorage.getItem("email")){var i='<li style="color:'+o+'; text-align: right;">'+n+" : Me</li>";$("#oList").append(i)}else{i='<li style="color:'+o+'; text-align: left;">'+t+" : "+n+"</li>";$("#oList").append(i)}}),socket.on("displayImgInd",function(e){if(e.fromEmail==localStorage.getItem("email")){var t=(new Date).getUTCMilliseconds(),n='<li style="color:'+e.clr+'; text-align: right;"><img id="'+t+'" width="300px" height="200px" align="middle">  : Me</li>';$("#oList").append(n);document.getElementById(t).src=decodeURIComponent(e.img)}else{t=(new Date).getUTCMilliseconds(),n='<li style="color:'+e.clr+'; text-align: left;"><p>'+e.from+' :                                                                     <img id="'+t+'" width="300px" height="200px" align="middle"></p</li>';$("#oList").append(n);document.getElementById(t).src=decodeURIComponent(e.img)}}),socket.on("displayImg",function(e,t,n,o,a){if(e==localStorage.getItem("email")){var i='<li style="color:'+o+'; text-align: right;"><img id="'+(l=(new Date).getUTCMilliseconds())+'" width="300px" height="200px" align="middle">  : Me</li>';$("#oList").append(i);document.getElementById(l).src=decodeURIComponent(n)}else{var l;i='<li style="color:'+o+'; text-align: left;"><p>'+t+' : <img id="'+(l=(new Date).getUTCMilliseconds())+'" width="300px" height="200px" align="middle"></p</li>';$("#oList").append(i);document.getElementById(l).src=decodeURIComponent(n)}}),$(window).on("keydown",function(e){if(13==e.which)return sendMessage(),!1}),window.onload=function(){null==localStorage.getItem("email")?CloseInput():("Admin"==localStorage.getItem("admin")?showAdmin():showNonAdmin(),connectUser(localStorage.getItem("name"),localStorage.getItem("email")))},$("#upfile1").click(function(){$("#file1").trigger("click")});var imageData="";$(function(){$(":file").change(function(){if(this.files&&this.files[0]){var e=new FileReader,t=this.files[0].size;Math.floor(t/1e3)<500?e.onload=imageIsLoaded:alert("Image size uploaded should not exceed 2 MB"),e.readAsDataURL(this.files[0])}})}),$(document).ready(function(){$("#message").bind("copy paste cut",function(e){e.preventDefault(),alert("cut,copy & paste options are disabled !!")})});